# Persistence

인메모리 데이터 스토어라 서버 재시작시 모든 데이터가 유실됨. 복제 기능을 사용해도 데이터 유실에 대해 안전하지 않음.

따라서 redis를 캐시 이외의 용도로 사용한다면 적절한 데이터 백업이 필요함.

## AOF (append only file)
```
데이터를 변경하는 커맨드가 들어오면 커맨드를 그대로 모두 저장함. 데이터가 커지게 됨. 따라서 주기적으로 압축해서 재 작성되는 과정을 거쳐야 함.

레디스 프로토콜 형태로 저장됨.

자동으로 생성하는 방법은 redis.conf 파일에서 auto-aof-rewrite-pertenage 옵션을 세팅한다.

수동으로 생성하는 방법은 BGREWRITEAOF 커맨드를 사용해서 CLI 창에서 수동으로 AOF 파일 저장
```

## RDB
```
스냅샷 방식을 사용하기 때문에 저장 당시의 메모리에 있는 데이터 그대로 파일로 저장함.

바이너리 파일 형태로 저장됨.

자동으로 생성하는 방법은 redis.conf 파일에서 save 옵션을 세팅한다.

수동으로 생성하는 방법은 BGSAVE 커맨드를 사용해서 CLI 창에서 수동으로 RDB 파일 저장.
```

## 선택 기준
```
백업은 필요하지만 어느정도 데이터 손실이 발생해도 괜찮은 경우
RDB 단독으로 사용.

장애 직전 상황까지 모든 데이터가 보장되어야 하는 경우
AOF 사용. 이때 APPENDFSYNC 옵션이 everysec인 경우 최대 1초 사이의 데이터 유실 가능성 존재

제일 강력한 내구성이 필요한 경우
둘 다 사용.
```
