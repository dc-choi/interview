# WebSocket

서버와 클라이언트간 실시간으로 메시지를 교환하기 위한 통신 방법이다.

양방향 통신으로 서로 원할 때 데이터를 주고 받을 수 있다.

연결지향적으로 실시간 네트워킹(채팅, 게임, 주식)에 사용된다.

## 연결 과정
1. Opening Handshake(연결 수립을 요청하는 헤더)
	```
	1. HTTP 1.1 이상이여야 한다.
	2. Upgrade는 현재 프로토콜에서 다른 프로토콜로 업그레이드 또는 변경할 때 사용한다. 그래서 HTTP에서 웹 소켓으로 변경해준다.
	이 값이 없거나 다른 값이면 cross-protocol attack으로 간주하고 웹 소켓 접속을 중지시킨다.
	3. Connection은 현재의 전송 완료 후 network를 유지할 것인지에 대한 정보.
	4. Sec-WebSocket-Key는 유효한 요청인지 확인하기 위해 사용하는 키 값.
	5. Sec-WebSocket-Protocol은 사용하고자 하는 하나 이상의 웹 소켓 프로토콜 지정.
	필요한 경우만 사용 Origin의 경우 모든 브라우저는 보안을 위해 이 헤더를 보낸다.
	대부분 어플리케이션은 이 헤더가 없는 요청을 거부하며, 이러한 이유로 CORS 정책이 만들어졌다.
	6. 상태 응답 코드 101은 프로토콜 전환을 서버가 승인했음을 알리는 코드.
	7. Upgrade와 Connection은 동일하게 넣어줘야 한다.
	```
2. Data Transfer(데이터 전송)
	```
	1. 웹소켓 연결이 수립되면 데이터 전송이 시작된다.
	2. 클라이언트와 서버가 메시지라는 개념으로 데이터를 주고 받는다.
	3. 한개 이상의 메시지는 프레임으로 구성
	4. 핸드세이크가 끝난 시점부터 서버와 클라이언트는 서로가 살아 있는지 확인하기 위해 heartbeat 패킷을 보내며, 주기적으로 ping을 보내 체크
	```
3. Closing Handshake(연결 종료를 요청하는 헤더)
	```
	1. 클라이언트나 서버가 커넥션 종료를 위한 컨트롤 프레임 전송.
	2. 컨트롤 프레임은 핸드세이크를 종료하라는 데이터를 가지고 있음.
	3. 이에 대한 응답으로 close 프레임 전송
	```

다만, 서로 문자열만 주고 받을 수 있으며, 문자열의 해독을 어플리케이션단에서 처리해야 한다.

HTTP의 경우 형식을 정해 놓아서 모두가 따르기만 하면 해석이 쉽지만 웹 소켓은 형식을 정해 놓지 않아서 해석이 어렵다.
